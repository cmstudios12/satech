<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Cart | SATECH ENTERPRISE</title>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css" />

  <style>
    :root {
      --navy: #0b1f3b;
      --blue: #1f4fd8;
      --light: #f6f8fc;
      --text: #1b1f2a;
      --muted: #6b7280;
      --border: #e5e7eb;
      --card: #ffffff;
      --success: #16a34a;
      --danger: #dc2626;
      --radius: 16px;
      --shadow: 0 12px 30px rgba(0, 0, 0, .08);
    }

    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
      font-family: Segoe UI, system-ui, -apple-system, Arial, sans-serif;
    }

    body {
      background: var(--light);
      color: var(--text);
      line-height: 1.4;
    }

    a {
      text-decoration: none;
      color: inherit;
    }

    /* HEADER */
    header {
      position: sticky;
      top: 0;
      z-index: 50;
      background: rgba(255, 255, 255, .9);
      backdrop-filter: blur(10px);
      border-bottom: 1px solid var(--border);
    }

    .header-inner {
      max-width: 1200px;
      margin: auto;
      padding: 1rem 1.25rem;
      display: flex;
      align-items: center;
      justify-content: space-between;
      gap: 1rem;
    }

    .brand {
      display: flex;
      align-items: center;
      gap: .8rem;
    }

    .brand img {
      height: 44px;
    }

    .back-btn {
      background: var(--blue);
      color: #fff;
      padding: .65rem 1.1rem;
      border-radius: 999px;
      font-weight: 700;
      display: inline-flex;
      align-items: center;
      gap: .5rem;
      border: none;
      cursor: pointer;
    }

    .back-btn:hover {
      opacity: .95;
    }

    /* HERO */
    .hero {
      max-width: 1200px;
      margin: 1.5rem auto 0;
      padding: 0 1.25rem;
    }

    .hero-card {
      background: var(--card);
      border: 1px solid var(--border);
      border-radius: var(--radius);
      padding: 1.5rem;
      box-shadow: 0 6px 18px rgba(0, 0, 0, .05);
      display: flex;
      align-items: center;
      justify-content: space-between;
      gap: 1rem;
      flex-wrap: wrap;
    }

    .hero h1 {
      font-size: 1.6rem;
      color: var(--navy);
    }

    .hero p {
      margin-top: .35rem;
      color: var(--muted);
    }

    .pill {
      background: rgba(31, 79, 216, .08);
      color: var(--blue);
      border: 1px solid rgba(31, 79, 216, .18);
      padding: .55rem .9rem;
      border-radius: 999px;
      font-weight: 700;
      font-size: .9rem;
      display: inline-flex;
      align-items: center;
      gap: .5rem;
    }

    /* LAYOUT */
    .wrap {
      max-width: 1200px;
      margin: 1.25rem auto 3rem;
      padding: 0 1.25rem;
      display: grid;
      grid-template-columns: 1.6fr .9fr;
      gap: 1.25rem;
      align-items: start;
    }

    @media (max-width: 920px) {
      .wrap {
        grid-template-columns: 1fr;
      }
    }

    /* CARDS */
    .card {
      background: var(--card);
      border: 1px solid var(--border);
      border-radius: var(--radius);
      box-shadow: 0 6px 18px rgba(0, 0, 0, .05);
      overflow: hidden;
    }

    .card-header {
      padding: 1rem 1.2rem;
      border-bottom: 1px solid var(--border);
      display: flex;
      justify-content: space-between;
      align-items: center;
      gap: 1rem;
    }

    .card-header h2 {
      font-size: 1rem;
      color: var(--navy);
      display: flex;
      align-items: center;
      gap: .55rem;
    }

    .small-muted {
      font-size: .9rem;
      color: var(--muted);
    }

    /* CART LIST */
    .cart-list {
      padding: 1rem 1.2rem;
      display: flex;
      flex-direction: column;
      gap: .9rem;
    }

    .cart-item {
      display: grid;
      grid-template-columns: 92px 1fr auto;
      gap: 1rem;
      padding: .9rem;
      border: 1px solid var(--border);
      border-radius: 14px;
      background: #fff;
      align-items: center;
    }

    @media (max-width: 520px) {
      .cart-item {
        grid-template-columns: 70px 1fr;
      }
      .item-price {
        grid-column: 1 / -1;
        text-align: right;
      }
    }

    .thumb {
      width: 92px;
      height: 72px;
      border-radius: 12px;
      background: var(--light);
      display: flex;
      align-items: center;
      justify-content: center;
      overflow: hidden;
    }

    .thumb img {
      width: 100%;
      height: 100%;
      object-fit: contain;
      padding: .4rem;
    }

    .item-info strong {
      display: block;
      font-size: 1rem;
      color: var(--navy);
    }

    .item-meta {
      margin-top: .25rem;
      color: var(--muted);
      font-size: .9rem;
    }

    .item-actions {
      margin-top: .65rem;
      display: flex;
      align-items: center;
      gap: .7rem;
      flex-wrap: wrap;
    }

    .qty {
      display: inline-flex;
      align-items: center;
      border: 1px solid var(--border);
      border-radius: 999px;
      overflow: hidden;
      background: #fff;
    }

    .qty button {
      width: 34px;
      height: 34px;
      border: none;
      background: #fff;
      cursor: pointer;
      font-weight: 800;
      color: var(--navy);
    }

    .qty input {
      width: 46px;
      height: 34px;
      border: none;
      text-align: center;
      outline: none;
      font-weight: 700;
      color: var(--text);
    }

    .danger-btn {
      border: 1px solid rgba(220, 38, 38, .25);
      background: rgba(220, 38, 38, .08);
      color: var(--danger);
      padding: .5rem .8rem;
      border-radius: 999px;
      font-weight: 800;
      cursor: pointer;
      display: inline-flex;
      align-items: center;
      gap: .5rem;
      font-size: .9rem;
    }

    .item-price {
      font-weight: 900;
      color: var(--blue);
      white-space: nowrap;
    }

    /* EMPTY STATE */
    .empty {
      padding: 2rem 1.2rem;
      text-align: center;
      color: var(--muted);
    }

    .empty i {
      font-size: 2rem;
      color: var(--blue);
      margin-bottom: .8rem;
    }

    .empty h3 {
      color: var(--navy);
      margin-bottom: .3rem;
    }

    /* SUMMARY */
    .summary {
      padding: 1rem 1.2rem;
      display: flex;
      flex-direction: column;
      gap: 1rem;
    }

    .row {
      display: flex;
      justify-content: space-between;
      align-items: center;
      gap: 1rem;
      font-size: .95rem;
      color: var(--text);
    }

    .row small {
      color: var(--muted);
      font-weight: 600;
    }

    .total {
      border-top: 1px dashed var(--border);
      padding-top: .9rem;
      font-size: 1.05rem;
      font-weight: 900;
      color: var(--navy);
    }

    .promo {
      display: grid;
      grid-template-columns: 1fr auto;
      gap: .6rem;
    }

    .promo input {
      padding: .8rem .9rem;
      border-radius: 12px;
      border: 1px solid var(--border);
      outline: none;
    }

    .promo button {
      padding: .8rem 1rem;
      border-radius: 12px;
      border: none;
      background: var(--blue);
      color: #fff;
      font-weight: 900;
      cursor: pointer;
    }

    .primary {
      width: 100%;
      padding: 1rem;
      border-radius: 14px;
      border: none;
      background: var(--navy);
      color: #fff;
      font-weight: 900;
      cursor: pointer;
      display: inline-flex;
      align-items: center;
      justify-content: center;
      gap: .6rem;
    }

    .primary:hover { opacity: .95; }

    .hint {
      color: var(--muted);
      font-size: .9rem;
      line-height: 1.3;
    }

    .strike {
      text-decoration: line-through;
      color: var(--danger);
      font-weight: 800;
      margin-right: .4rem;
    }

    /* MODAL */
    .overlay {
      position: fixed;
      inset: 0;
      background: rgba(0, 0, 0, .6);
      display: none;
      align-items: center;
      justify-content: center;
      padding: 1rem;
      z-index: 1000;
    }

    .modal {
      width: 100%;
      max-width: 560px;
      background: #fff;
      border-radius: 18px;
      overflow: hidden;
      box-shadow: var(--shadow);
      animation: pop .2s ease;
    }

    @keyframes pop {
      from { transform: translateY(10px); opacity: 0; }
      to { transform: translateY(0); opacity: 1; }
    }

    .modal-head {
      padding: 1rem 1.2rem;
      border-bottom: 1px solid var(--border);
      display: flex;
      align-items: center;
      justify-content: space-between;
      gap: 1rem;
    }

    .modal-head h2 {
      color: var(--navy);
      font-size: 1.1rem;
      display: flex;
      align-items: center;
      gap: .6rem;
    }

    .xbtn {
      border: none;
      background: rgba(31, 79, 216, .08);
      color: var(--blue);
      width: 40px;
      height: 40px;
      border-radius: 12px;
      cursor: pointer;
      font-size: 1rem;
      font-weight: 900;
    }

    .modal-body {
      padding: 1rem 1.2rem 1.2rem;
      display: grid;
      gap: .8rem;
    }

    label {
      font-weight: 800;
      font-size: .9rem;
      color: var(--navy);
    }

    input, select {
      width: 100%;
      padding: .8rem .9rem;
      border-radius: 12px;
      border: 1px solid var(--border);
      outline: none;
    }

    .grid2 {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: .8rem;
    }

    @media (max-width: 520px) {
      .grid2 { grid-template-columns: 1fr; }
    }

    .paybox {
      display: none;
      background: var(--light);
      border: 1px dashed rgba(31, 79, 216, .35);
      border-radius: 14px;
      padding: 1rem;
      margin-top: .2rem;
      color: var(--text);
      font-size: .95rem;
    }

    .paybox h3 {
      color: var(--navy);
      margin-bottom: .6rem;
      font-size: 1rem;
    }

    .payrow {
      display: flex;
      justify-content: space-between;
      gap: 1rem;
      padding: .25rem 0;
      border-bottom: 1px solid rgba(229, 231, 235, .7);
    }

    .payrow:last-child { border-bottom: none; }

    .btnrow {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: .7rem;
      margin-top: .6rem;
    }

    .ghost {
      background: rgba(31, 79, 216, .08);
      color: var(--blue);
      border: 1px solid rgba(31, 79, 216, .18);
      font-weight: 900;
    }

    /* TOAST */
    .toast {
      position: fixed;
      top: 18px;
      right: 18px;
      background: #fff;
      border-radius: 14px;
      padding: .9rem 1rem;
      min-width: 260px;
      box-shadow: var(--shadow);
      display: flex;
      gap: .7rem;
      align-items: flex-start;
      z-index: 2000;
      animation: slide .25s ease;
      border-left: 5px solid var(--blue);
    }

    .toast.success { border-left-color: var(--success); }
    .toast.error { border-left-color: var(--danger); }

    .toast i { margin-top: .15rem; color: var(--blue); }
    .toast.success i { color: var(--success); }
    .toast.error i { color: var(--danger); }

    .toast-title { font-weight: 900; color: var(--navy); }
    .toast-msg { color: var(--muted); font-size: .9rem; margin-top: .15rem; }

    @keyframes slide {
      from { transform: translateY(-10px); opacity: 0; }
      to { transform: translateY(0); opacity: 1; }
    }
  </style>
</head>

<body>

  <header>
    <div class="header-inner">
      <a class="brand" href="dashboard.html">
        <img src="logo.png" alt="SATECH Logo">
      </a>
      <button class="back-btn" onclick="location.href='dashboard.html'">
        <i class="fa-solid fa-arrow-left"></i> Back
      </button>
    </div>
  </header>

  <section class="hero">
    <div class="hero-card">
      <div>
        <h1>Your Cart</h1>
        <p>Review your items and proceed to checkout when ready.</p>
      </div>
      <div class="pill" id="itemCountPill">
        <i class="fa-solid fa-bag-shopping"></i> 0 items
      </div>
    </div>
  </section>

  <main class="wrap">
    <!-- CART -->
    <section class="card">
      <div class="card-header">
        <h2><i class="fa-solid fa-cart-shopping"></i> Items</h2>
        <div class="small-muted">Adjust quantities or remove items</div>
      </div>
      <div class="cart-list" id="cartSection"></div>
    </section>

    <!-- SUMMARY -->
    <aside class="card">
      <div class="card-header">
        <h2><i class="fa-solid fa-receipt"></i> Summary</h2>
        <div class="small-muted">Delivery calculated at checkout</div>
      </div>
      <div class="summary">
        <div class="promo">
          <input type="text" id="promoCode" placeholder="Promo code (e.g. SAVE250)">
          <button onclick="applyPromo()">Apply</button>
        </div>

        <div class="row"><span>Subtotal</span><strong>R<span id="subTotal">0</span></strong></div>
        <div class="row">
          <span>Delivery</span>
          <strong id="deliveryLine"><small>Calculated</small></strong>
        </div>
        <div class="row total">
          <span>Total</span>
          <strong>R<span id="totalPrice">0</span></strong>
        </div>

        <button class="primary" onclick="openCheckout()">
          <i class="fa-solid fa-lock"></i> Proceed to Checkout
        </button>

        <div class="hint" id="deliveryInfo"></div>
      </div>
    </aside>
  </main>

  <!-- CHECKOUT MODAL -->
  <div class="overlay" id="checkoutOverlay">
    <div class="modal">
      <div class="modal-head">
        <h2><i class="fa-solid fa-truck-fast"></i> Delivery Details</h2>
        <button class="xbtn" onclick="closeCheckout()"><i class="fa-solid fa-xmark"></i></button>
      </div>

      <div class="modal-body">
        <div>
          <label>Full Name</label>
          <input type="text" id="fullName" placeholder="John Doe" required>
        </div>

        <div>
          <label>Street Address</label>
          <input type="text" id="streetAddress" placeholder="123 Main Street" required>
        </div>

        <div class="grid2">
          <div>
            <label>City</label>
            <input type="text" id="city" placeholder="Johannesburg" required>
          </div>
          <div>
            <label>Postal Code</label>
            <input type="text" id="postalCode" placeholder="2000" required>
          </div>
        </div>

        <div>
          <label>Province</label>
          <select id="province" required>
            <option value="">Select Province</option>
            <option>Gauteng</option>
            <option>KwaZulu-Natal</option>
            <option>Western Cape</option>
            <option>Eastern Cape</option>
            <option>Limpopo</option>
            <option>Mpumalanga</option>
            <option>North West</option>
            <option>Northern Cape</option>
            <option>Free State</option>
          </select>
        </div>

        <div class="btnrow">
          <button class="primary ghost" onclick="closeCheckout()">
            <i class="fa-solid fa-arrow-left"></i> Back
          </button>
          <button class="primary" onclick="showPayment()">
            Continue <i class="fa-solid fa-arrow-right"></i>
          </button>
        </div>

        <div class="paybox" id="paymentBox">
          <h3><i class="fa-solid fa-building-columns"></i> Payment Details</h3>

          <div class="payrow"><span><strong>Bank</strong></span><span>TymeBank</span></div>
          <div class="payrow"><span><strong>Account Name</strong></span><span>SATECH ENTERPRISE</span></div>
          <div class="payrow"><span><strong>Account Number</strong></span><span>51131411363</span></div>
          <div class="payrow"><span><strong>Branch Code</strong></span><span>678910</span></div>
          <div class="payrow"><span><strong>Reference</strong></span><span id="paymentRef"></span></div>
          <div class="payrow"><span><strong>Total Due</strong></span><span>R<span id="checkoutTotal"></span></span></div>

          <div style="margin-top:.8rem;color:var(--muted);font-size:.92rem;line-height:1.35;">
            Send proof of payment to:
            <br><strong>Email:</strong> payments@satech.co.za
            <br><strong>WhatsApp:</strong> +27 76 864 1645
          </div>
        </div>
      </div>
    </div>
  </div>

  <script>
    let cart = JSON.parse(localStorage.getItem('cart')) || [];
    let promoApplied = false;

    const DELIVERY_FEE = 110;
    const DELIVERY_THRESHOLD = 5000;

    function toast(type, title, msg) {
      const t = document.createElement("div");
      t.className = `toast ${type}`;
      t.innerHTML = `
        <i class="fa-solid ${type === "success" ? "fa-circle-check" : type === "error" ? "fa-triangle-exclamation" : "fa-circle-info"}"></i>
        <div>
          <div class="toast-title">${title}</div>
          <div class="toast-msg">${msg}</div>
        </div>
      `;
      document.body.appendChild(t);
      setTimeout(() => t.remove(), 4200);
    }

    function money(n) {
      return Number(n || 0).toLocaleString();
    }

    function calcSubtotal() {
      return cart.reduce((s, i) => s + (i.price * i.qty), 0);
    }

    function updateSummary() {
      const subtotal = calcSubtotal();
      document.getElementById('subTotal').innerText = money(subtotal);
      document.getElementById('totalPrice').innerText = money(subtotal); // delivery added later at payment step
      document.getElementById('itemCountPill').innerHTML = `<i class="fa-solid fa-bag-shopping"></i> ${cart.reduce((s,i)=>s+i.qty,0)} items`;

      const deliveryInfo = document.getElementById('deliveryInfo');
      const deliveryLine = document.getElementById('deliveryLine');

      if (subtotal <= 0) {
        deliveryInfo.innerHTML = "";
        deliveryLine.innerHTML = "<small>â€”</small>";
        return;
      }

      if (subtotal >= DELIVERY_THRESHOLD) {
        deliveryLine.innerHTML = `<span class="strike">R${DELIVERY_FEE}</span> <span style="color:var(--success);font-weight:900;">Free</span>`;
        deliveryInfo.innerHTML = `ðŸŽ‰ Free delivery applied on orders over R${money(DELIVERY_THRESHOLD)}.`;
      } else {
        deliveryLine.innerHTML = `<small>R${DELIVERY_FEE} if under R${money(DELIVERY_THRESHOLD)}</small>`;
        deliveryInfo.innerHTML = `Delivery fee of R${DELIVERY_FEE} applies for orders under R${money(DELIVERY_THRESHOLD)}.`;
      }
    }

    function renderCart() {
      const c = document.getElementById('cartSection');
      c.innerHTML = '';

      if (!cart.length) {
        c.innerHTML = `
          <div class="empty">
            <i class="fa-solid fa-cart-shopping"></i>
            <h3>Your cart is empty</h3>
            <p>Add products to your cart to see them here.</p>
            <div style="margin-top:1rem;">
              <button class="primary" onclick="location.href='dashboard.html'" style="max-width:260px;">
                <i class="fa-solid fa-store"></i> Continue Shopping
              </button>
            </div>
          </div>
        `;
        updateSummary();
        return;
      }

      cart.forEach((item, i) => {
        c.innerHTML += `
          <div class="cart-item">
            <div class="thumb"><img src="${item.img}" alt="${item.name}"></div>

            <div class="item-info">
              <strong>${item.name}</strong>
              <div class="item-meta">Code: ${item.code}</div>

              <div class="item-actions">
                <div class="qty">
                  <button onclick="changeQty(${i}, -1)">âˆ’</button>
                  <input type="number" min="1" value="${item.qty}" onchange="setQty(${i}, this.value)">
                  <button onclick="changeQty(${i}, 1)">+</button>
                </div>

                <button class="danger-btn" onclick="deleteItem(${i})">
                  <i class="fa-solid fa-trash"></i> Remove
                </button>
              </div>
            </div>

            <div class="item-price">R${money(item.price * item.qty)}</div>
          </div>
        `;
      });

      updateSummary();
    }

    function saveCart() {
      localStorage.setItem('cart', JSON.stringify(cart));
    }

    function setQty(i, v) {
      const val = Math.max(1, parseInt(v || 1));
      cart[i].qty = val;
      saveCart();
      renderCart();
    }

    function changeQty(i, delta) {
      const next = (cart[i].qty || 1) + delta;
      cart[i].qty = Math.max(1, next);
      saveCart();
      renderCart();
    }

    function deleteItem(i) {
      cart.splice(i, 1);
      saveCart();
      toast("success", "Removed", "Item removed from your cart.");
      renderCart();
    }

    function applyPromo() {
      const code = document.getElementById('promoCode').value.trim();
      if (!code) return toast("error", "Promo Code", "Please enter a promo code.");
      if (promoApplied) return toast("error", "Promo Code", "Promo already applied.");

      const total = calcSubtotal();
      if (total < 1200) return toast("error", "Promo Code", "Total must be at least R1200 to apply promo.");

      if (code.toUpperCase() === "SAVE250") {
        cart = cart.map(item => ({ ...item, price: item.price - 250 }));
        saveCart();
        promoApplied = true;
        toast("success", "Promo Applied", "R250 discount applied to each item.");
        renderCart();
      } else {
        toast("error", "Invalid Promo", "That promo code is not valid.");
      }
    }

    function openCheckout() {
      if (!cart.length) return toast("error", "Checkout", "Your cart is empty.");
      document.getElementById("checkoutOverlay").style.display = "flex";
      document.getElementById("paymentBox").style.display = "none";
    }

    function closeCheckout() {
      document.getElementById("checkoutOverlay").style.display = "none";
    }

    function showPayment() {
      const name = document.getElementById('fullName').value.trim();
      const street = document.getElementById('streetAddress').value.trim();
      const city = document.getElementById('city').value.trim();
      const postal = document.getElementById('postalCode').value.trim();
      const province = document.getElementById('province').value;

      if (!name || !street || !city || !postal || !province) {
        return toast("error", "Delivery Details", "Please fill in all delivery details.");
      }

      let total = calcSubtotal();
      if (total < DELIVERY_THRESHOLD) total += DELIVERY_FEE;

      document.getElementById("checkoutTotal").innerText = money(total);
      document.getElementById("paymentRef").innerText =
        "SATECH-" + Math.floor(Math.random() * 900000 + 100000);

      document.getElementById("paymentBox").style.display = "block";
      toast("success", "Almost Done", "Payment details generated. Use the reference when paying.");
    }

    // Close modal when clicking outside
    document.getElementById("checkoutOverlay").addEventListener("click", (e) => {
      if (e.target.id === "checkoutOverlay") closeCheckout();
    });

    renderCart();
  </script>

</body>
</html>
