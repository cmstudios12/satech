<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Auth | SATECH ENTERPRISE</title>

<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css">
<script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>

<style>
:root{
 --navy:#0b1c2d;
 --blue:#1e5eff;
 --green:#2ecc71;
 --red:#e74c3c;
 --radius:16px;
 --muted:#f4f6f8;
}
*{box-sizing:border-box}
body{
 margin:0;
 font-family:Segoe UI,system-ui;
 background:linear-gradient(135deg,#f8fbff,#eef4ff);
 min-height:100vh;
 display:flex;
 align-items:center;
 justify-content:center;
 padding:1rem;
}

/* AUTH CARD */
.auth-box{
 background:#fff;
 width:100%;
 max-width:420px;
 padding:2rem;
 border-radius:var(--radius);
 box-shadow:0 25px 60px rgba(0,0,0,.1);
}
.logo{
 display:block;
 margin:auto;
 height:42px;
 margin-bottom:1rem;
}

/* TABS */
.tabs{
 display:flex;
 background:var(--muted);
 border-radius:50px;
 margin-bottom:1.2rem;
}
.tab{
 flex:1;
 padding:.7rem;
 text-align:center;
 font-weight:600;
 cursor:pointer;
 font-size:.9rem;
}
.tab.active{
 background:var(--blue);
 color:#fff;
}

/* FIELDS */
.field{margin-bottom:.8rem}
.field input,.field select{
 width:100%;
 padding:.75rem;
 border-radius:12px;
 border:1px solid #ccc;
 font-size:.9rem;
}

/* BUTTON */
button{
 width:100%;
 padding:.85rem;
 border:none;
 border-radius:14px;
 background:var(--navy);
 color:#fff;
 font-weight:600;
 display:flex;
 align-items:center;
 justify-content:center;
 gap:.5rem;
 cursor:pointer;
}
.hidden{display:none}

/* LOADER */
.loader{
 width:18px;height:18px;
 border-radius:50%;
 border:3px solid #fff;
 border-top:3px solid transparent;
 animation:spin 1s linear infinite;
}
@keyframes spin{to{transform:rotate(360deg)}}

/* PROFESSIONAL TOAST */
.toast{
 position:fixed;
 top:20px;
 right:20px;
 background:#fff;
 min-width:260px;
 max-width:340px;
 padding:.9rem 1rem;
 border-radius:14px;
 box-shadow:0 15px 40px rgba(0,0,0,.15);
 display:flex;
 gap:.7rem;
 z-index:9999;
 animation:slide .4s ease;
}
.toast.success{border-left:5px solid var(--green)}
.toast.error{border-left:5px solid var(--red)}
.toast i{font-size:1.2rem}
.toast.success i{color:var(--green)}
.toast.error i{color:var(--red)}
.toast-title{font-weight:700}
.toast-msg{font-size:.8rem}

@keyframes slide{
 from{opacity:0;transform:translateY(-10px)}
 to{opacity:1;transform:translateY(0)}
}

/* MOBILE */
@media(max-width:480px){
 .auth-box{padding:1.5rem}
 .toast{left:50%;right:auto;transform:translateX(-50%)}
}
</style>
</head>

<body>

<div class="auth-box">
<img src="logo.png" class="logo">

<div class="tabs">
 <div class="tab active" id="loginTab">Sign In</div>
 <div class="tab" id="signupTab">Sign Up</div>
</div>

<form id="loginForm">
 <div class="field"><input type="email" id="loginEmail" placeholder="Email" required></div>
 <div class="field"><input type="password" id="loginPassword" placeholder="Password" required></div>
 <button>
  <span class="btn-text">Sign In</span>
  <span class="loader hidden"></span>
 </button>
</form>

<form id="signupForm" class="hidden">
 <div class="field"><input id="fullNames" placeholder="Full Names" required></div>
 <div class="field"><input id="surname" placeholder="Surname" required></div>
 <div class="field">
  <select id="gender" required>
   <option value="">Select Gender</option>
   <option>Male</option>
   <option>Female</option>
  </select>
 </div>
 <div class="field"><input type="email" id="signupEmail" placeholder="Email" required></div>
 <div class="field"><input id="phone" placeholder="Phone (06/07/08...)" required></div>
 <div class="field"><input type="password" id="signupPassword" placeholder="Password" required></div>
 <div class="field"><input type="password" id="confirmPassword" placeholder="Confirm Password" required></div>
 <button>
  <span class="btn-text">Create Account</span>
  <span class="loader hidden"></span>
 </button>
</form>
</div>

<script>
const supabaseClient = supabase.createClient(
 "https://nzuwmiyduragtqyaetfr.supabase.co",
 "sb_publishable_0VN3EDApVH9bzKu2eH7fvg_5JfYOGMh"
);

/* TOAST */
function toast(type,title,msg){
 const t=document.createElement("div");
 t.className=`toast ${type}`;
 t.innerHTML=`
  <i class="fa-solid ${type==="success"?"fa-circle-check":"fa-triangle-exclamation"}"></i>
  <div>
   <div class="toast-title">${title}</div>
   <div class="toast-msg">${msg}</div>
  </div>`;
 document.body.appendChild(t);
 setTimeout(()=>t.remove(),4000);
}

/* TABS */
loginTab.onclick=()=>{loginForm.classList.remove("hidden");signupForm.classList.add("hidden");loginTab.classList.add("active");signupTab.classList.remove("active")}
signupTab.onclick=()=>{signupForm.classList.remove("hidden");loginForm.classList.add("hidden");signupTab.classList.add("active");loginTab.classList.remove("active")}

/* LOADING */
function loading(btn,on){
 btn.querySelector(".btn-text").classList.toggle("hidden",on);
 btn.querySelector(".loader").classList.toggle("hidden",!on);
}

/* SIGNUP */
signupForm.onsubmit=async e=>{
 e.preventDefault();
 const btn=signupForm.querySelector("button");
 loading(btn,true);

 const {data,error}=await supabaseClient.auth.signUp({
  email:signupEmail.value,
  password:signupPassword.value
 });

 if(error){loading(btn,false);return toast("error","Signup Failed",error.message)}

 await supabaseClient.from("profiles").insert({
  id:data.user.id,
  full_names:fullNames.value,
  surname:surname.value,
  phone:phone.value,
  gender:gender.value
 });

 loading(btn,false);
 toast("success","Account Created","You can now sign in.");
 setTimeout(()=>loginTab.click(),1200);
};

/* LOGIN */
loginForm.onsubmit=async e=>{
 e.preventDefault();
 const btn=loginForm.querySelector("button");
 loading(btn,true);

 const {data,error}=await supabaseClient.auth.signInWithPassword({
  email:loginEmail.value,
  password:loginPassword.value
 });

 if(error){
  loading(btn,false);
  if(error.message.toLowerCase().includes("confirm")){
    return toast("error","Email Not Confirmed","Please confirm your email before logging in.");
  }
  return toast("error","Login Failed",error.message);
 }

 const {data:profile}=await supabaseClient
  .from("profiles")
  .select("surname,gender")
  .eq("id",data.user.id)
  .single();

 loading(btn,false);
 const title=profile.gender==="Male"?"Mr":"Ms";
 toast("success","Welcome",`Welcome ${title} ${profile.surname}`);

 setTimeout(()=>location.href="dashboard.html",1800);
};
</script>

</body>
</html>
