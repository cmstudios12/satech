<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>SATECH ENTERPRISE | Dashboard</title>

  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css">
  <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>

  <style>
    :root{
      --navy:#0b1c2d;
      --blue:#1e5eff;
      --light:#fff;
      --muted:#f4f6f8;
      --radius:16px;
      --border:#e5e7eb;
      --danger:#e74c3c;
      --wa:#25D366;
    }

    *{ box-sizing:border-box; margin:0; padding:0; }
    body{
      font-family:'Segoe UI',system-ui,sans-serif;
      background:var(--light);
      color:#111;
      line-height:1.6;
    }
    a{ text-decoration:none; color:inherit; }
    img{ max-width:100%; display:block; }

    /* HEADER */
    header{
      position:sticky;
      top:0;
      z-index:5000;
      background:rgba(255,255,255,.92);
      backdrop-filter:blur(10px);
      border-bottom:1px solid var(--border);
    }

    .nav{
      max-width:1200px;
      margin:auto;
      padding:1rem;
      display:flex;
      align-items:center;
      justify-content:space-between;
      gap:1rem;
    }

    .brand img.logo{
      height:48px;
      max-width:160px;
    }

    /* Desktop nav links (simple + clean) */
    .nav-links{
      display:flex;
      align-items:center;
      gap:1.4rem;
      flex-wrap:wrap;
    }

    .nav-links a{
      position:relative;
      padding:.35rem 0;
      font-weight:700;
      color:var(--navy);
      white-space:nowrap;
    }

    .nav-links a::after{
      content:'';
      position:absolute;
      left:0; bottom:0;
      width:0; height:2px;
      background:var(--blue);
      transition:.25s;
    }
    .nav-links a:hover::after{ width:100%; }

    /* Right actions */
    .nav-actions{
      display:flex;
      align-items:center;
      gap:12px;
      position:relative;
    }

    .icon-btn{
      width:42px;height:42px;
      border-radius:50%;
      display:flex;
      align-items:center;
      justify-content:center;
      background:var(--navy);
      color:#fff;
      transition:.2s;
      flex:0 0 auto;
    }
    .icon-btn:hover{ background:var(--blue); }

    .user-initials{
      width:42px;height:42px;
      border-radius:50%;
      display:flex;
      align-items:center;
      justify-content:center;
      background:var(--blue);
      color:#fff;
      font-weight:900;
      user-select:none;
      cursor:pointer;
      transition:.2s;
      position:relative;
      flex:0 0 auto;
    }
    .user-initials:hover{ transform:scale(1.05); }

    /* User dropdown */
    .user-menu{
      position:absolute;
      top:120%;
      right:0;
      background:#fff;
      border:1px solid var(--border);
      border-radius:12px;
      box-shadow:0 12px 30px rgba(0,0,0,.12);
      overflow:hidden;
      min-width:210px;
      display:none;
      z-index:6000;
    }
    .user-menu a{
      display:flex;
      align-items:center;
      gap:.7rem;
      padding:.75rem 1rem;
      font-weight:800;
      color:var(--navy);
    }
    .user-menu a i{ color:var(--blue); }
    .user-menu a:hover{ background:var(--muted); }
    .user-menu a.logout i{ color:var(--danger); }

    .user-initials.open .user-menu{ display:block; }

    /* MOBILE MENU BAR (NO HAMBURGER) */
    .mobile-menu-bar{
      display:none;
      max-width:1200px;
      margin:0 auto;
      padding:0 1rem 1rem;
    }

    .chip-row{
      display:flex;
      gap:.65rem;
      overflow-x:auto;
      padding:.25rem .15rem;
      -webkit-overflow-scrolling:touch;
      scrollbar-width:none;
    }
    .chip-row::-webkit-scrollbar{ display:none; }

    .chip{
      display:inline-flex;
      align-items:center;
      gap:.55rem;
      padding:.65rem .9rem;
      border-radius:999px;
      border:1px solid var(--border);
      background:#fff;
      color:var(--navy);
      font-weight:800;
      white-space:nowrap;
      flex:0 0 auto;
      transition:.18s;
    }
    .chip i{ color:var(--blue); }
    .chip:hover{
      border-color:#cbd5e1;
      transform:translateY(-1px);
    }

    .chip.primary{
      background:var(--navy);
      border-color:var(--navy);
      color:#fff;
    }
    .chip.primary i{ color:#fff; }

    .chip.logout{
      background:#fff5f5;
      border-color:#fecaca;
      color:var(--navy);
    }
    .chip.logout i{ color:var(--danger); }

    /* HERO */
    .hero{
      background:linear-gradient(135deg,#f0f4ff,#eef4ff);
      border-radius:var(--radius);
      margin:1rem;
      overflow:hidden;
    }
    .hero-inner{
      max-width:1200px;
      margin:auto;
      padding:4rem 1.5rem;
      display:grid;
      grid-template-columns:1.2fr 1fr;
      gap:3rem;
      align-items:center;
    }
    .hero h1{
      font-size:3rem;
      color:var(--navy);
      letter-spacing:-.02em;
    }
    .hero p{
      margin:1rem 0;
      color:#555;
      max-width:52ch;
    }
    .btn{
      display:inline-flex;
      gap:.6rem;
      align-items:center;
      justify-content:center;
      padding:.9rem 1.6rem;
      border-radius:50px;
      background:var(--blue);
      color:#fff;
      font-weight:900;
      transition:.2s;
    }
    .btn:hover{ transform:scale(1.03); }

    /* Sections */
    section{ padding:4rem 1.5rem; }
    .container{ max-width:1200px; margin:auto; }
    .section-title{ font-size:2rem; margin-bottom:2rem; color:var(--navy); }

    /* Products */
    .products{
      display:grid;
      grid-template-columns:repeat(auto-fit,minmax(250px,1fr));
      gap:2rem;
    }
    .product{
      border:1px solid var(--border);
      border-radius:var(--radius);
      padding:1.5rem;
      background:#fff;
      display:flex;
      flex-direction:column;
      min-height:290px;
      transition:.25s;
    }
    .product:hover{
      box-shadow:0 10px 30px rgba(0,0,0,.08);
      transform:translateY(-2px);
    }
    .product-img{
      background:#f8f9fb;
      border-radius:12px;
      padding:1rem;
      min-height:160px;
      display:flex;
      align-items:center;
      justify-content:center;
      margin-bottom:1rem;
    }
    .product-img img{ max-height:140px; width:auto; transition:transform .25s; }
    .product:hover .product-img img{ transform:scale(1.05); }
    .product h3{ color:var(--navy); margin:.25rem 0 1rem; font-size:1.15rem; }

    .add-cart{
      border:none;
      background:var(--navy);
      color:#fff;
      padding:.8rem 1rem;
      border-radius:12px;
      font-weight:900;
      cursor:pointer;
      transition:.2s;
      margin-top:auto;
    }
    .add-cart:hover{ background:var(--blue); transform:scale(1.02); }

    /* Footer */
    footer{
      background:var(--navy);
      color:#fff;
      padding:3rem 1.5rem;
    }
    footer .container{
      display:grid;
      grid-template-columns:repeat(auto-fit,minmax(220px,1fr));
      gap:2rem;
    }
    footer a{ color:#fff; text-decoration:underline; }

    /* Toast */
    .toast{
      position:fixed;
      top:1rem; right:1rem;
      background:#4ade80;
      color:#fff;
      padding:1rem 1.2rem;
      border-radius:12px;
      box-shadow:0 10px 30px rgba(0,0,0,.15);
      opacity:0;
      transform:translateY(-20px);
      transition:.35s;
      z-index:9000;
      max-width:340px;
      font-weight:900;
    }
    .toast.show{ opacity:1; transform:translateY(0); }

    /* ===== WhatsApp Popup + Floating Button ===== */
    .wa-fab{
      position:fixed;
      right:18px;
      bottom:18px;
      width:56px;
      height:56px;
      border-radius:999px;
      background:var(--wa);
      color:#fff;
      display:flex;
      align-items:center;
      justify-content:center;
      box-shadow:0 14px 30px rgba(0,0,0,.18);
      z-index:9500;
      border:none;
      cursor:pointer;
      transition:.2s;
    }
    .wa-fab:hover{ transform:translateY(-2px) scale(1.02); }

    .wa-popup{
      position:fixed;
      right:18px;
      bottom:86px;
      width:min(360px, calc(100vw - 36px));
      background:#fff;
      border:1px solid var(--border);
      border-radius:18px;
      box-shadow:0 18px 55px rgba(0,0,0,.18);
      overflow:hidden;
      z-index:9501;
      opacity:0;
      transform:translateY(10px);
      pointer-events:none;
      transition:.22s ease;
    }
    .wa-popup.open{
      opacity:1;
      transform:translateY(0);
      pointer-events:auto;
    }

    .wa-head{
      background:linear-gradient(135deg, #1fbf5b, #0ea25c);
      color:#fff;
      padding:14px 14px 12px;
      display:flex;
      align-items:center;
      justify-content:space-between;
      gap:10px;
    }
    .wa-head .left{
      display:flex;
      align-items:center;
      gap:10px;
      min-width:0;
    }
    .wa-badge{
      width:38px;height:38px;
      border-radius:12px;
      background:rgba(255,255,255,.18);
      display:flex;
      align-items:center;
      justify-content:center;
      flex:0 0 auto;
    }
    .wa-head h4{
      font-size:1rem;
      line-height:1.1;
      margin:0;
      font-weight:900;
      white-space:nowrap;
      overflow:hidden;
      text-overflow:ellipsis;
      max-width:220px;
    }
    .wa-head small{
      display:block;
      opacity:.95;
      font-weight:700;
      margin-top:2px;
      white-space:nowrap;
      overflow:hidden;
      text-overflow:ellipsis;
      max-width:220px;
    }

    .wa-close{
      width:36px;height:36px;
      border-radius:12px;
      border:none;
      background:rgba(255,255,255,.18);
      color:#fff;
      cursor:pointer;
      display:flex;
      align-items:center;
      justify-content:center;
      transition:.15s;
      flex:0 0 auto;
    }
    .wa-close:hover{ background:rgba(255,255,255,.28); }

    .wa-body{
      padding:14px;
    }

    .wa-note{
      background:var(--muted);
      border:1px solid var(--border);
      border-radius:14px;
      padding:12px;
      color:#222;
      font-weight:800;
      margin-bottom:10px;
    }

    .wa-form{
      display:flex;
      gap:10px;
      align-items:stretch;
    }
    .wa-input{
      flex:1;
      border:1px solid var(--border);
      border-radius:14px;
      padding:12px 12px;
      font-weight:800;
      outline:none;
    }
    .wa-input:focus{
      border-color:#b8c7ff;
      box-shadow:0 0 0 3px rgba(30,94,255,.12);
    }

    .wa-send{
      border:none;
      border-radius:14px;
      padding:12px 14px;
      background:var(--navy);
      color:#fff;
      font-weight:900;
      cursor:pointer;
      transition:.18s;
      display:inline-flex;
      align-items:center;
      gap:8px;
      white-space:nowrap;
    }
    .wa-send:hover{ background:var(--blue); transform:translateY(-1px); }

    .wa-quick{
      display:flex;
      flex-wrap:wrap;
      gap:8px;
      margin-top:10px;
    }
    .wa-quick button{
      border:1px solid var(--border);
      background:#fff;
      border-radius:999px;
      padding:8px 10px;
      font-weight:800;
      color:var(--navy);
      cursor:pointer;
      transition:.15s;
    }
    .wa-quick button:hover{
      background:var(--muted);
      transform:translateY(-1px);
    }

    .wa-privacy{
      margin-top:10px;
      color:#666;
      font-size:.85rem;
      font-weight:700;
    }

    /* Responsive */
    @media (max-width: 900px){
      .nav-links{ display:none; }
      .mobile-menu-bar{ display:block; }

      .hero-inner{
        grid-template-columns:1fr;
        padding:1.4rem;
        gap:1.25rem;
      }
      .hero h1{ font-size:2rem; }
      .hero-inner img{ order:-1; }
    }

    @media(max-width:560px){
      .products{ gap:1rem; }
      .product{ padding:1.15rem; min-height:auto; }
      .product-img{ min-height:140px; }
      .add-cart{ width:100%; }
      .wa-popup{ bottom:82px; }
      .wa-fab{ width:54px; height:54px; }
    }
  </style>
</head>

<body>

<header>
  <div class="nav">
    <div class="brand">
      <a href="dashboard.html"><img src="logo.png" class="logo" alt="Logo"></a>
    </div>

    <!-- Desktop nav -->
    <nav class="nav-links" aria-label="Primary navigation">
      <a href="dashboard.html">Home</a>
      <a href="ref.html">Refurbished</a>
      <a href="new.html">New</a>
      <a href="iphones.html">iPhones</a>
      <a href="acc.html">Accessories</a>
      <a href="repair.html">Repairs</a>
      <a href="contact.html">Contact</a>
      <a href="orders.html">Orders</a>
      <a href="settings.html">Account Settings</a>
    </nav>

    <div class="nav-actions">
      <div class="user-initials" id="userInitials" aria-label="User menu">
        U
        <div class="user-menu" id="userMenu">
          <a href="orders.html"><i class="fa-solid fa-box"></i> Orders</a>
          <a href="settings.html"><i class="fa-solid fa-gear"></i> Account Settings</a>
          <a href="#" class="logout" id="logoutDesktop"><i class="fa-solid fa-right-from-bracket"></i> Logout</a>
        </div>
      </div>

      <a href="cart.html" class="icon-btn" aria-label="Cart">
        <i class="fa-solid fa-cart-shopping"></i>
      </a>
    </div>
  </div>

  <!-- Mobile menu bar (chips) -->
  <div class="mobile-menu-bar">
    <div class="chip-row" aria-label="Mobile navigation">
      <a class="chip primary" href="dashboard.html"><i class="fa-solid fa-house"></i> Home</a>
      <a class="chip" href="ref.html"><i class="fa-solid fa-laptop"></i> Refurbished</a>
      <a class="chip" href="new.html"><i class="fa-solid fa-laptop-code"></i> New</a>
      <a class="chip" href="iphones.html"><i class="fa-brands fa-apple"></i> iPhones</a>
      <a class="chip" href="acc.html"><i class="fa-solid fa-headphones"></i> Accessories</a>
      <a class="chip" href="repair.html"><i class="fa-solid fa-screwdriver-wrench"></i> Repairs</a>
      <a class="chip" href="contact.html"><i class="fa-solid fa-envelope"></i> Contact</a>
      <a class="chip" href="orders.html"><i class="fa-solid fa-box"></i> Orders</a>
      <a class="chip" href="settings.html"><i class="fa-solid fa-gear"></i> Settings</a>
      <a class="chip logout" href="#" id="logoutMobile"><i class="fa-solid fa-right-from-bracket"></i> Logout</a>
    </div>
  </div>
</header>

<div class="toast" id="toast"></div>

<!-- HERO -->
<section class="hero">
  <div class="hero-inner">
    <div>
      <h1>Premium Gadgets & Reliable Repairs</h1>
      <p>Refurbished & new laptops, iPhones, smart devices and professional technical repairs, trusted by businesses and individuals.</p>
      <a href="#products" class="btn"><i class="fa-solid fa-bag-shopping"></i> Shop Now</a>
    </div>
    <img src="gadgets.png" alt="Gadgets">
  </div>
</section>

<!-- PRODUCTS -->
<section id="products" class="container">
  <h2 class="section-title">Popular Products</h2>

  <div class="products">
    <div class="product">
      <div class="product-img"><img src="hp.png" alt="Refurbished Laptop"></div>
      <h3>Refurbished Laptop</h3>
      <button class="add-cart" onclick="window.location.href='ref.html'">View Laptops</button>
    </div>

    <div class="product">
      <div class="product-img"><img src="HP_Pavilion_14.png" alt="New Laptops"></div>
      <h3>New Laptops</h3>
      <button class="add-cart" onclick="window.location.href='new.html'">View Laptops</button>
    </div>

    <div class="product">
      <div class="product-img"><img src="i13.png" alt="iPhones"></div>
      <h3>iPhones</h3>
      <button class="add-cart" onclick="window.location.href='iphones.html'">View Phones</button>
    </div>

    <div class="product">
      <div class="product-img"><img src="smart.png" alt="Smart Watches"></div>
      <h3>Smart Watches</h3>
      <button class="add-cart" onclick="window.location.href='acc.html'">View Accessories</button>
    </div>
  </div>
</section>

<!-- SERVICES -->
<section id="services" class="container">
  <h2 class="section-title">Technical Services</h2>

  <div style="display:grid;grid-template-columns:repeat(auto-fit,minmax(240px,1fr));gap:1rem;">
    <div style="background:var(--muted);border:1px solid var(--border);border-radius:14px;padding:1rem 1.1rem;font-weight:900;color:var(--navy);">
      Laptop Software & Hardware Repairs
    </div>
    <div style="background:var(--muted);border:1px solid var(--border);border-radius:14px;padding:1rem 1.1rem;font-weight:900;color:var(--navy);">
      Phone Screen & Back Cover Replacement
    </div>
    <div style="background:var(--muted);border:1px solid var(--border);border-radius:14px;padding:1rem 1.1rem;font-weight:900;color:var(--navy);">
      Diagnostics & Performance Upgrades
    </div>
  </div>
</section>

<!-- CONTACT -->
<section id="contact" class="container">
  <h2 class="section-title">Contact Us</h2>
  <p style="color:#444;font-weight:800;background:var(--muted);border:1px solid var(--border);border-radius:14px;padding:1rem 1.1rem;max-width:520px;">
    Email: info@satech.co.za<br>Phone: +27 81 840 1398
  </p>
</section>

<!-- FOOTER -->
<footer>
  <div class="container">
    <div>
      <h3>SATECH ENTERPRISE</h3>
      <p>Powered by <a href="https://cmstudio.online" target="_blank" rel="noopener noreferrer">CMSTUDIO</a></p>
    </div>
    <div>
      <h4>Quick Links</h4>
      <p>Shop • Repairs • Support</p>
    </div>
    <div>
      <h4>Secure Payments</h4>
      <p>Card • EFT • PayFast (Coming Soon)</p>
    </div>
  </div>
</footer>

<!-- ===== WhatsApp Popup UI ===== -->
<button class="wa-fab" id="waFab" aria-label="Open WhatsApp chat">
  <i class="fa-brands fa-whatsapp" style="font-size:1.6rem;"></i>
</button>

<div class="wa-popup" id="waPopup" role="dialog" aria-modal="true" aria-label="WhatsApp chat popup">
  <div class="wa-head">
    <div class="left">
      <div class="wa-badge" aria-hidden="true">
        <i class="fa-brands fa-whatsapp" style="font-size:1.2rem;"></i>
      </div>
      <div style="min-width:0;">
        <h4>Chat on WhatsApp</h4>
        <small>Usually replies fast</small>
      </div>
    </div>
    <button class="wa-close" id="waClose" aria-label="Close WhatsApp popup">
      <i class="fa-solid fa-xmark"></i>
    </button>
  </div>

  <div class="wa-body">
    <div class="wa-note">
      Need help with laptops, iPhones, accessories or repairs? Send us a message.
    </div>

    <form class="wa-form" id="waForm">
      <input
        class="wa-input"
        id="waMessage"
        type="text"
        placeholder="Type your message..."
        maxlength="500"
        autocomplete="off"
      />
      <button class="wa-send" type="submit">
        <i class="fa-solid fa-paper-plane"></i> Send
      </button>
    </form>

    <div class="wa-quick" aria-label="Quick messages">
      <button type="button" data-msg="Hi, I need help with a repair.">Repair</button>
      <button type="button" data-msg="Hi, do you have refurbished laptops available?">Refurb Laptops</button>
      <button type="button" data-msg="Hi, I'm looking for an iPhone. What do you have in stock?">iPhones</button>
      <button type="button" data-msg="Hi, I need accessories. Please assist.">Accessories</button>
    </div>

    <div class="wa-privacy">
      By messaging, you’ll be redirected to WhatsApp.
    </div>
  </div>
</div>

<script>
  // Supabase
  const supabaseClient = supabase.createClient(
    "https://nzuwmiyduragtqyaetfr.supabase.co",
    "sb_publishable_0VN3EDApVH9bzKu2eH7fvg_5JfYOGMh"
  );

  const toast = document.getElementById("toast");
  const userInitials = document.getElementById("userInitials");

  function showToast(msg){
    toast.textContent = msg;
    toast.classList.add("show");
    setTimeout(()=>toast.classList.remove("show"), 3500);
  }

  // User menu open/close
  userInitials.addEventListener("pointerup", (e)=>{
    e.stopPropagation();
    userInitials.classList.toggle("open");
  });

  document.addEventListener("pointerup", ()=>{
    userInitials.classList.remove("open");
  });

  async function doLogout(e){
    if(e) e.preventDefault();
    await supabaseClient.auth.signOut();
    location.href = "login.html";
  }

  document.getElementById("logoutDesktop").addEventListener("pointerup", doLogout);
  document.getElementById("logoutMobile").addEventListener("pointerup", doLogout);

  async function checkLogin(){
    const { data:{ user } } = await supabaseClient.auth.getUser();
    if(!user) return location.href="login.html";

    const { data: profile } = await supabaseClient
      .from("profiles")
      .select("full_names,surname,gender")
      .eq("id", user.id)
      .maybeSingle();

    // initials
    if(profile?.full_names && profile?.surname){
      const initials = (profile.full_names[0] || "U") + (profile.surname[0] || "");
      userInitials.firstChild.textContent = initials.toUpperCase();

      // toast
      let title = "";
      if(profile.gender === "Male") title = "Mr ";
      else if(profile.gender === "Female") title = "Ms ";
      showToast(profile.surname ? `Welcome ${title}${profile.surname}` : "Welcome!");
    } else {
      userInitials.firstChild.textContent = "U";
      showToast("Welcome!");
    }
  }

  checkLogin();

  /* ===== WhatsApp Popup Logic =====
     - Uses your business number: +27 81 840 1398
     - Opens wa.me with a prefilled message
  */
  const WA_NUMBER = "27818401398"; // no +, no spaces
  const waFab = document.getElementById("waFab");
  const waPopup = document.getElementById("waPopup");
  const waClose = document.getElementById("waClose");
  const waForm = document.getElementById("waForm");
  const waMessage = document.getElementById("waMessage");

  function openWaPopup(){
    waPopup.classList.add("open");
    setTimeout(()=>waMessage?.focus(), 50);
  }
  function closeWaPopup(){
    waPopup.classList.remove("open");
  }
  function toggleWaPopup(){
    waPopup.classList.toggle("open");
    if(waPopup.classList.contains("open")) setTimeout(()=>waMessage?.focus(), 50);
  }

  function openWhatsAppWithMessage(message){
    const text = encodeURIComponent(message || "Hi, I need assistance.");
    const url = `https://wa.me/${27768641645}?text=${text}`;
    window.open(url, "_blank", "noopener,noreferrer");
  }

  waFab.addEventListener("click", (e)=>{
    e.stopPropagation();
    toggleWaPopup();
  });

  waClose.addEventListener("click", (e)=>{
    e.stopPropagation();
    closeWaPopup();
  });

  // Close popup if clicking outside it (but not when clicking the button itself)
  document.addEventListener("click", (e)=>{
    const clickedInside = waPopup.contains(e.target) || waFab.contains(e.target);
    if(!clickedInside) closeWaPopup();
  });

  // ESC to close
  document.addEventListener("keydown", (e)=>{
    if(e.key === "Escape") closeWaPopup();
  });

  waForm.addEventListener("submit", (e)=>{
    e.preventDefault();
    const msg = (waMessage.value || "").trim();
    openWhatsAppWithMessage(msg || "Hi, I need assistance.");
    waMessage.value = "";
    closeWaPopup();
  });

  // Quick message buttons
  document.querySelectorAll(".wa-quick button").forEach(btn=>{
    btn.addEventListener("click", ()=>{
      const msg = btn.getAttribute("data-msg") || "Hi, I need assistance.";
      openWhatsAppWithMessage(msg);
    });
  });

  // Optional: auto-open once per session after a short delay
  // if(!sessionStorage.getItem("waPopupShown")){
  //   setTimeout(openWaPopup, 2500);
  //   sessionStorage.setItem("waPopupShown", "1");
  // }
</script>

</body>
</html>
